(function ($) {
    "use strict";

    $.jQax = function (options) {

        // Load Defaults and make them public
        this.defaults = {
            setRequestUri: _spPageContextInfo.webAbsoluteUrl + "/_layouts/15/nsn/AjaxGetData.aspx",
            setRequestHeaders: { "accept": "application/json; charset=utf-8" },
            ShowLoading: false,
            LoaderContainerId: "#preloader",
            LoaderText: "",
            ErrorCallBack: function (XMLHttpRequest, textStatus, errorThrown) {
                var response = eval("(" + XMLHttpRequest.responseText + ")");
                var output = "Message: " + response.Message + "\n\n";
                output += "StackTrace: " + response.StackTrace;
                //console.log(output);
                toastr.options = {
                    "closeButton": false,
                    "debug": false,
                    "newestOnTop": false,
                    "progressBar": false,
                    "positionClass": "toast-bottom-full-width",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "300",
                    "hideDuration": "1000",
                    "timeOut": "5000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                }
                toastr["error"]('<div>' + output + '</div>');

            }
        };

        // Extend defaults into options
        var o = $.extend({}, this.defaults, options);

        this.setParams = function () {
            try {
                var obj = {};
                //var _pAnno = '0';
                //var _pMese = '0';
                //var _pTipoLinea = '0';
                var _pTipoLavorazione = '0';
                //var _pTipoAttivita = '0';
                var _pTipoCessazioniPAFId = '0';
                //var _pLoadTrend = 'false';

                //_pAnno = $.trim($('.hdtxtYear').val());
                //_pMese = $.trim($('.hdtxtMonth').val());
                //_pTipoLinea = $.trim($('.hdtxtpTipoLinea').val());
                _pTipoLavorazione = $.trim($('.hdtxtpTipoLavorazione').val());
                //_pTipoAttivita = $.trim($('.hdtxtpTipoAttivita').val());
                if (_pTipoLavorazione != null && _pTipoLavorazione == '2') {
                    //_pTipoCessazioniPAFId = $.trim($('.hdtxtpTipoPAFAttivita').val());
                    _pTipoCessazioniPAFId = '0';
                }
                else {
                    _pTipoCessazioniPAFId = '0';
                }
                
                //_pLoadTrend = $.trim($('.hdtxtpLoadTrend').val());

                //obj.pAnno = _pAnno;
                //obj.pMese = _pMese > 0 ? _pMese : (_getDate.getMonth() + 1);

                obj.pAnno = $.trim($('.hdtxtYear').val());
                obj.pMese = $.trim($('.hdtxtMonth').val());
                obj.pTipoLinea = $.trim($('.hdtxtpTipoLinea').val());
                obj.pTipoLavorazione = _pTipoLavorazione;
                obj.pTipoAttivita = $.trim($('.hdtxtpTipoAttivita').val());
                obj.pTipoCessazioniPAFId = _pTipoCessazioniPAFId;
                obj.pLoadTrend = $.trim($('.hdtxtpLoadTrend').val());

                return JSON.stringify(obj);
            } catch (e) {
                //console.log(e);
            }
        }

        this.Get = function (WebService, GetData, SuccessCallBack, ShowLoading, LoaderText, ErrorCallback) {

            if (ShowLoading != null ? ShowLoading : o.ShowLoading)
                ShowLoader(LoaderText != null ? LoaderText : o.LoaderText);

            if (WebService == "")
                return 1; // Incorrect Parameters

            if (ErrorCallback == null)
                ErrorCallback = o.ErrorCallBack;

            if (GetData != null && typeof (GetData) === "object")
                GetData = $.param(GetData);

            $.ajax({
                type: "GET",
                url: o.setRequestUri + "/" + WebService,
                data: GetData,
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                cache: false,
                async: false,
                success: SuccessCallBack,
                error: ErrorCallback
            });

            return 0; // Successful
        };

        this.Post = function (WebService, JsonData, SuccessCallBack, ShowLoading, LoaderText, ErrorCallback) {

            if (ShowLoading != null ? ShowLoading : o.ShowLoading)
                ShowLoader(LoaderText != null ? LoaderText : o.LoaderText);

            if (WebService == "")
                return 1; // Incorrect Parameters

            if (ErrorCallback == null)
                ErrorCallback = o.ErrorCallBack;

            if (typeof (JsonData) === "object")
                //JsonData = JSON.stringify(JsonData);
                JsonData = this.setParams();

            $.ajax({
                type: "POST",
                url: o.setRequestUri + "/" + WebService,
                data: JsonData,
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                cache: false,
                async: false,
                success: SuccessCallBack,
                error: ErrorCallback
            });

            return 0; // Successful
        };

        function ShowLoader(LoaderText) {

            //$(o.LoaderContainerId).text(LoaderText);
            //$(o.LoaderContainerId).fadeIn("slow");

            $('#status').fadeIn();
            $(o.LoaderContainerId).text(LoaderText);
            $(o.LoaderContainerId).delay(350).fadeIn('slow');
            $('body').delay(350).css({
                'overflow': 'visible'
            });
        };

        $(document).ready(function () {

            $(o.LoaderContainerId).ajaxStop(function () {

                $('#status').fadeOut();
                $(this).stop(true, true).fadeOut("slow");
                $('body').delay(350).css({
                    'overflow': 'none'
                });
            });

        });

        return this;
    };
})(jQuery);